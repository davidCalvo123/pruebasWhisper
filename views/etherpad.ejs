<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas Etherpad</title>
    <link rel="stylesheet" href="/etherpad.css">
</head>
<body>
    <h1>Pruebas de Etherpad</h1>

    <!-- Formulario para crear un pad -->
    <form id="createPadForm" action="/etherpad/create" method="post">
        <input type="text" name="padID" id="padID" placeholder="ID del pad" required>
        <button type="submit">Crear Pad</button>
    </form>

    <h2>Crear Pad con Texto</h2>
    <form id="createPadWithTextForm" action="/etherpad/createWithText" method="post">
        <label for="padIDWithText">ID del Pad:</label>
        <input type="text" name="padID" id="padIDWithText" placeholder="ID del pad" required>
    
        <label for="padText">Texto para insertar (usa *negrita*, **naranja**, ***rojo***):</label>
        <textarea name="text" id="padText" placeholder="Introduce el texto aquí..." required></textarea>
    
        <button type="submit">Crear Pad con Texto</button>
    </form>
    <!-- Botón para eliminar todos los pads -->
    <button id="deleteAllPadsButton" class="delete-all">Eliminar Todos los Pads</button>

    <h2>Crear un Pad con Contenido</h2>

    <form id="createPadWithContentForm" action="/etherpad/createWithContent" method="post">
        <label for="padID">ID del Pad:</label>
        <input type="text" name="padID" id="padID" placeholder="ID del pad" required>
    
        <label for="content">Contenido HTML:</label>
        <textarea name="content" id="content" placeholder="Escribe aquí tu HTML. Ejemplo: <strong>Texto en negrita</strong>" required></textarea>
    
        <button type="submit">Crear Pad con Contenido</button>
    </form>

    <!-- Iframe para mostrar el pad directamente -->
    <h2>Ver y editar Pad</h2>
    <input type="text" id="padIDInput" placeholder="Introduce el ID del Pad" />
    <button id="viewPadButton">Ver Pad</button>

    <div id="padContainer" class="pad-container">
        <iframe id="padFrame"></iframe>
    </div>

    <button onclick="window.location.href='/'">Volver a la página principal</button>

    <!-- Modal de notificación -->
    <div id="popupModal" class="modal">
        <span class="modal-close" id="closeModal">&times;</span>
        <h2 id="popupMessage"></h2>
    </div>

    <script>
        document.getElementById('viewPadButton').addEventListener('click', async () => {
            const padID = document.getElementById('padIDInput').value;
            const iframe = document.getElementById('padFrame');

            if (padID) {
                try {
                    const response = await fetch(`/etherpad/check/${padID}`);
                    const result = await response.json();

                    if (result.success) {
                        iframe.src = `http://localhost:9001/p/${padID}`; // Asegúrate de que esta URL esté bien formada
                        showPopup(`El pad con ID '${padID}' se ha cargado.`, 'success');
                    } else {
                        showPopup(`El pad con ID '${padID}' no existe.`, 'warning');
                    }
                } catch (error) {
                    console.error('Error al consultar si el pad existe:', error);
                    showPopup('Ocurrió un error al verificar el pad.', 'error');
                }
            } else {
                showPopup('Introduce un ID de Pad válido', 'error');
            }
        });
        const form = document.getElementById('createPadForm');
        const deleteAllPadsButton = document.getElementById('deleteAllPadsButton');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            try {
                const response = await fetch('/etherpad/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (result.success && result.message === 'El pad se ha creado con éxito.') {
                    showPopup(result.message, 'success');
                } else if (result.message === 'El pad ya existe.') {
                    showPopup(result.message, 'warning');
                } else {
                    showPopup(result.message, 'error');
                }
            } catch (error) {
                console.error('Error al crear el pad:', error);
                showPopup('Ocurrió un error inesperado. Inténtalo de nuevo.', 'error');
            }
        });

        deleteAllPadsButton.addEventListener('click', async () => {
            if (confirm('¿Estás seguro de que deseas eliminar todos los pads? Esta acción no se puede deshacer.')) {
                try {
                    const response = await fetch('/etherpad/deleteAll', { method: 'POST' });
                    const result = await response.json();
                    if (result.success) {
                        showPopup(result.message, 'success');
                    } else {
                        showPopup(result.message, 'error');
                    }
                } catch (error) {
                    console.error('Error al eliminar todos los pads:', error);
                    showPopup('Ocurrió un error al eliminar los pads.', 'error');
                }
            }
        });

        function showPopup(message, type) {
            const modal = document.getElementById('popupModal');
            const popupMessage = document.getElementById('popupMessage');

            // Reiniciar estilos previos
            modal.classList.remove('success', 'error', 'warning');

            // Asignar el mensaje y tipo de estilo
            popupMessage.textContent = message;
            modal.classList.add('show', type); // Añade la clase correspondiente (success, error, warning)

            setTimeout(() => {
                modal.classList.remove('show');
            }, 3000); // Eliminar modal después de 3 segundos
        }

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('popupModal').classList.remove('show');
        });
    </script>
    <script>
        //script para crea un pad con texto dentro 
    const form2 = document.getElementById('createPadWithContentForm');
    
    form2.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form2);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/etherpad/createWithContent', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (result.success) {
                alert('El pad se ha creado con éxito');
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            console.error('Error al crear el pad:', error);
            alert('Ocurrió un error inesperado.');
        }
    });


    </script>
</body>
</html>